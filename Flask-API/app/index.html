<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Socket.IO EnvÃ­o de UbicaciÃ³n</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <h1>UbicaciÃ³n en tiempo real con Socket.IO</h1>

  <!-- ğŸ”˜ Botones existentes -->
  <button onclick="enviarUbicacion()">ğŸ“ Enviar ubicaciÃ³n fija</button>
  <button onclick="usarGPS()">ğŸ“¡ Usar GPS del navegador</button>

  <hr>

  <!-- ğŸ“‹ Formulario de envÃ­o manual -->
  <h2>Enviar ubicaciÃ³n personalizada</h2>
  <form id="ubicacionForm" onsubmit="enviarFormulario(event)">
    <label>Cuenta ID: <input type="number" id="cuenta_id" required></label><br>
    <label>Latitud: <input type="number" step="any" id="lat" required></label><br>
    <label>Longitud: <input type="number" step="any" id="lon" required></label><br>
    <button type="submit">ğŸ“¤ Enviar UbicaciÃ³n</button>
  </form>

  <script>
    const socket = io("http://localhost:5000");

    socket.on("connect", () => {
      console.log("ğŸŸ¢ Conectado al servidor");
    });

    socket.on("UBICACION", data => {
      console.log("ğŸ“ UBICACION recibida:", data);
    });

    socket.on("ALERTA_SALIDA_ZONA", data => {
      console.log("ğŸš¨ Salida de zona segura:", data);
    });

    socket.on("ALERTA_ENTRADA_ZONA", data => {
      console.log("ğŸš¨ Entrada de zona segura:", data);
    });

    socket.on("ULTIMAS_ALERTAS", data => {
      console.log("ğŸš¨ ultimas alertastas:", data);
    });



    socket.on("ERROR", msg => {
      console.error("âŒ ERROR:", msg);
    });

    function enviarUbicacion() {
      const data = {
        cuenta_id: 1,
        lat: 19.432608,
        lon: -99.133209
      };
      console.log("ğŸ“¤ Enviando ubicaciÃ³n fija:", data);
      socket.emit("ubicacion", data);
    }

    function usarGPS() {
      if (!navigator.geolocation) {
        return console.error("GeolocalizaciÃ³n no soportada");
      }

      navigator.geolocation.getCurrentPosition(pos => {
        const data = {
          cuenta_id: 123,
          lat: pos.coords.latitude,
          lon: pos.coords.longitude
        };
        console.log("ğŸ“¤ Enviando ubicaciÃ³n con GPS:", data);
        socket.emit("ubicacion", data);
      }, err => {
        console.error("âŒ Error obteniendo GPS:", err.message);
      });
    }

    function enviarFormulario(event) {
      event.preventDefault();
      const cuenta_id = parseInt(document.getElementById("cuenta_id").value);
      const lat = parseFloat(document.getElementById("lat").value);
      const lon = parseFloat(document.getElementById("lon").value);

      const data = { cuenta_id, lat, lon };
      console.log("ğŸ“¤ Enviando ubicaciÃ³n desde formulario:", data);
      socket.emit("ubicacion", data);
    }
  </script>
</body>
</html>
